#Part 1: Load Data and Exploratory Data Analysis (EDA)
#Before we build a model, we must understand our data.
print(f"\n--- PART 1: Load Data and Exploratory Data Analysis (EDA) ---")

#1.1: Load the Data
#We define the path to the file in your Google Drive and load it into a pandas DataFrame.
file_name = '/content/drive/My Drive/SR386_labels.csv'

try:
    df = pd.read_csv(file_name)
    print(f"Successfully loaded '{file_name}'.")
except FileNotFoundError:
    print(f"ERROR: File not found. Please ensure 'SR386_labels.csv' is in your 'My Drive' folder.")
    exit()

#1.2: Examine Data Structure
#Let's look at the first few rows (`.head()`) and the data types (`.info()`) to see what our data looks like.
print("\n[EDA] Data Head:")
print(df.head())
print("\n[EDA] Data Info:")
df.info()

#1.3: Investigate Target Variable
#Our target is 'died_within_5_years'.

#1.We see from the `.info()` and the CSV snippet that it contains string 'NULL' values.
#2.We must convert these to actual NaN (Not a Number) values.
#3.We must then *drop* these rows, as an unknown outcome is useless for training or testing our supervised model.
#4.Finally, we convert the target to a numeric type (int).
print("\n[EDA] Cleaning Target Variable 'died_within_5_years'...")
print(f"Original value counts:\n{df['died_within_5_years'].value_counts(dropna=False)}")

df['died_within_5_years'] = df['died_within_5_years'].replace('NULL', np.nan)
df.dropna(subset=['died_within_5_years'], inplace=True)
df['died_within_5_years'] = pd.to_numeric(df['died_within_5_years']).astype(int)

#1.4: Check for Class Imbalance
#Now we check the distribution of our *cleaned* target variable.
#This is critical, as an imbalanced dataset (e.g., 90% Survived, 10% Died) can bias our model.
print("\n[EDA] Cleaned target variable distribution (0=Survived, 1=Died):")
print(df['died_within_5_years'].value_counts(normalize=True))

plt.figure(figsize=(6, 4))
sns.countplot(x='died_within_5_years', data=df)
plt.title('Distribution of Target Variable (0=Survived, 1=Died)')
plt.show()
print(">> EDA finding: The dataset is imbalanced. 'Died' (1) is the minority class.")

#1.5: Visualize Key Features
#Let's plot distributions for other important features.
print("\n[EDA] Visualizing Key Features...")

#Age
plt.figure(figsize=(8, 5))
sns.histplot(df['age_at_diagnosis'].dropna(), kde=True, bins=30)
plt.title('Distribution of Age at Diagnosis')
plt.show()

#Sex
plt.figure(figsize=(6, 4))
sns.countplot(x='sex', data=df)
plt.title('Distribution of Sex')
plt.show()

#Tumor Stage
plt.figure(figsize=(8, 5))
sns.countplot(x='stage', data=df.sort_values('stage'))
plt.title('Distribution of Tumor Stage')
plt.show()

#1.6: Identify Missing Values
#We need to know which columns have missing data to plan our cleaning strategy.
print("\n[EDA] Missing Values Count (Top 15):")
missing_values = df.isnull().sum()
print(missing_values[missing_values > 0].sort_values(ascending=False).head(15))
